<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì¥ë‹˜ í”ŒëŸ¬ìŠ¤ í—¬í”„ì„¼í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .function-selected {
            background-color: #dbeafe !important;
            border-left: 4px solid #3b82f6 !important;
        }
        .admin-selected {
            background-color: #dcfce7 !important;
            border-left: 4px solid #22c55e !important;
        }
        .tab-active {
            background-color: #3b82f6 !important;
            color: white !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen">
        <!-- 1ê³„ì¸µ: ê¸°ëŠ¥ ëª©ë¡ -->
        <div class="w-80 bg-white border-r border-gray-200 flex flex-col">
            <div class="p-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-800">ì‚¬ì¥ë‹˜ í”ŒëŸ¬ìŠ¤ í—¬í”„ì„¼í„°</h2>
                <p class="text-sm text-gray-500 mt-1">ìˆ˜í–‰í•  ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”</p>
                <div class="mt-2">
                    <button id="cookie-sync-btn" class="px-3 py-1 text-xs bg-purple-600 text-white rounded hover:bg-purple-700">
                        ğŸª ì¿ í‚¤ ë™ê¸°í™”
                    </button>
                    <button id="token-sync-btn" class="px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 ml-2">
                        ğŸ”„ í† í° ë™ê¸°í™”
                    </button>
                    <span id="token-status" class="text-xs text-gray-400 ml-2 block mt-1">ìƒíƒœ: í™•ì¸ì¤‘...</span>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto">
                <div class="function-item p-4 cursor-pointer border-b border-gray-100 hover:bg-blue-50" data-function="qr-create">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="text-blue-600">ğŸ”§</div>
                            <div>
                                <div class="font-medium text-gray-800">ê°€ë§¹ì  ìƒì„± ë° QR í™œì„±í™”</div>
                                <div class="text-xs text-gray-500 mt-1">3ê°œ ì–´ë“œë¯¼ ì—°ê´€</div>
                            </div>
                        </div>
                        <div class="text-gray-400">â†’</div>
                    </div>
                </div>

                <div class="function-item p-4 cursor-pointer border-b border-gray-100 hover:bg-blue-50" data-function="qr-recovery">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="text-blue-600">âš¡</div>
                            <div>
                                <div class="font-medium text-gray-800">ê°€ë§¹ì  QR ë³µêµ¬</div>
                                <div class="text-xs text-gray-500 mt-1">3ê°œ ì–´ë“œë¯¼ ì—°ê´€</div>
                            </div>
                        </div>
                        <div class="text-gray-400">â†’</div>
                    </div>
                </div>

                <div class="function-item p-4 cursor-pointer border-b border-gray-100 hover:bg-blue-50" data-function="permission">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="text-blue-600">ğŸ”’</div>
                            <div>
                                <div class="font-medium text-gray-800">ë§¤ì¥ ê¶Œí•œë³€ê²½</div>
                                <div class="text-xs text-gray-500 mt-1">3ê°œ ì–´ë“œë¯¼ ì—°ê´€</div>
                            </div>
                        </div>
                        <div class="text-gray-400">â†’</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2ê³„ì¸µ: ì–´ë“œë¯¼ ëª©ë¡ -->
        <div id="admin-panel" class="w-80 bg-white border-r border-gray-200 flex-col hidden">
            <div class="p-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800">ì–´ë“œë¯¼ ëª©ë¡</h3>
                <p class="text-sm text-gray-500 mt-1" id="function-name">ì„ íƒëœ ê¸°ëŠ¥</p>
            </div>
            <div class="flex-1 overflow-y-auto" id="admin-list">
                <!-- ì–´ë“œë¯¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- 3ê³„ì¸µ: ì½˜í…ì¸  ì˜ì—­ -->
        <div class="flex-1 flex flex-col">
            <div id="empty-state" class="flex items-center justify-center h-full">
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸ–¥ï¸</div>
                    <h3 class="text-xl font-medium text-gray-500 mb-2">ì–´ë“œë¯¼ì„ ì„ íƒí•˜ì„¸ìš”</h3>
                    <p class="text-gray-400">ë¨¼ì € ìˆ˜í–‰í•  ê¸°ëŠ¥ì„ ì„ íƒí•œ í›„ ì–´ë“œë¯¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¿ í‚¤ ë™ê¸°í™” ëª¨ë‹¬ -->
    <div id="cookie-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full m-4 max-h-[80vh] overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">ğŸª ì¿ í‚¤ ê´€ë¦¬</h3>
            <div class="mb-4">
                <h4 class="font-medium mb-2">í˜„ì¬ ì €ì¥ëœ ì¿ í‚¤:</h4>
                <div id="cookie-list" class="bg-gray-100 p-3 rounded text-sm font-mono max-h-40 overflow-y-auto">
                    ë¡œë”©ì¤‘...
                </div>
            </div>
            <div class="mb-4">
                <h4 class="font-medium mb-2">ì¿ í‚¤ ì¶”ê°€/ìˆ˜ì •:</h4>
                <input id="cookie-input" type="text" 
                       placeholder="name=value; domain=.example.com; path=/" 
                       class="w-full p-2 border rounded text-sm">
                <button onclick="addCookie()" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    ì¿ í‚¤ ì¶”ê°€
                </button>
            </div>
            <button onclick="closeCookieModal()" class="w-full p-3 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">
                ë‹«ê¸°
            </button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        const functionData = {
            'qr-create': {
                name: 'ê°€ë§¹ì  ìƒì„± ë° QR í™œì„±í™”',
                admins: [
                    {
                        name: 'ì™€ì¹¸ë‹¤_ì‹ ì²­ì„œ',
                        url: 'https://www.google.com',
                        desc: 'ê°€ë§¹ì  ì‹ ì²­ì„œ ì‘ì„±',
                        isInternal: false
                    },
                    {
                        name: 'ì™€ì¹¸ë‹¤_í™œì„±í™”',
                        url: 'https://www.naver.com',
                        desc: 'ê°€ë§¹ì  í™œì„±í™” ì²˜ë¦¬',
                        isInternal: false
                    },
                    {
                        name: 'ì˜¤í”„ë¼ì¸_QRìƒì„±ìš”ì²­',
                        url: 'https://admin.example.com/qr',
                        desc: 'ì˜¤í”„ë¼ì¸ QR ìƒì„±',
                        isInternal: true
                    }
                ]
            },
            'qr-recovery': {
                name: 'ê°€ë§¹ì  QR ë³µêµ¬',
                admins: [
                    {
                        name: 'QR ê´€ë¦¬',
                        url: 'https://admin.example.com/qr-manage',
                        desc: 'QR ë³µêµ¬',
                        isInternal: true
                    },
                    {
                        name: 'ë¡œê·¸ ê´€ë¦¬',
                        url: 'https://admin.example.com/logs',
                        desc: 'ë¡œê·¸ í™•ì¸',
                        isInternal: true
                    },
                    {
                        name: 'ê°€ë§¹ì  ê´€ë¦¬',
                        url: 'https://www.kakao.com',
                        desc: 'ìƒíƒœ í™•ì¸',
                        isInternal: false
                    }
                ]
            },
            'permission': {
                name: 'ë§¤ì¥ ê¶Œí•œë³€ê²½',
                admins: [
                    {
                        name: 'ê¶Œí•œ ê´€ë¦¬',
                        url: 'https://admin.example.com/permissions',
                        desc: 'ê¶Œí•œ ì„¤ì •',
                        isInternal: true
                    },
                    {
                        name: 'ì‚¬ìš©ì ê´€ë¦¬',
                        url: 'https://admin.example.com/users',
                        desc: 'ì—­í•  ê´€ë¦¬',
                        isInternal: true
                    },
                    {
                        name: 'ê°ì‚¬ ê´€ë¦¬',
                        url: 'https://www.youtube.com',
                        desc: 'ë³€ê²½ ì´ë ¥',
                        isInternal: false
                    }
                ]
            }
        };

        let selectedFunction = null;
        let selectedAdmin = null;
        let windowRefs = {};

        // ì¿ í‚¤ ê´€ë¦¬ í•¨ìˆ˜
        function getAllCookies() {
            const cookies = {};
            document.cookie.split(';').forEach(cookie => {
                const [name, value] = cookie.trim().split('=');
                if (name) cookies[name] = value;
            });
            return cookies;
        }

        function setCookie(name, value, options = {}) {
            let cookieString = `${name}=${value}`;
            
            if (options.domain) cookieString += `; domain=${options.domain}`;
            if (options.path) cookieString += `; path=${options.path}`;
            if (options.expires) cookieString += `; expires=${options.expires}`;
            if (options.maxAge) cookieString += `; max-age=${options.maxAge}`;
            if (options.secure) cookieString += `; secure`;
            if (options.sameSite) cookieString += `; samesite=${options.sameSite}`;
            
            document.cookie = cookieString;
        }

        function showCookieModal() {
            const modal = document.getElementById('cookie-modal');
            modal.classList.remove('hidden');
            updateCookieList();
        }

        function closeCookieModal() {
            document.getElementById('cookie-modal').classList.add('hidden');
        }

        function updateCookieList() {
            const cookies = getAllCookies();
            const cookieList = document.getElementById('cookie-list');
            
            if (Object.keys(cookies).length === 0) {
                cookieList.textContent = 'ì¿ í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.';
            } else {
                cookieList.innerHTML = Object.entries(cookies)
                    .map(([name, value]) => `<div>${name}=${value}</div>`)
                    .join('');
            }
        }

        function addCookie() {
            const input = document.getElementById('cookie-input').value.trim();
            if (!input) return;
            
            try {
                // ê°„ë‹¨í•œ ì¿ í‚¤ íŒŒì‹±
                const parts = input.split(';').map(p => p.trim());
                const [name, value] = parts[0].split('=');
                
                const options = {};
                parts.slice(1).forEach(part => {
                    const [key, val] = part.split('=');
                    options[key.toLowerCase()] = val || true;
                });
                
                setCookie(name, value, options);
                updateCookieList();
                document.getElementById('cookie-input').value = '';
                alert('ì¿ í‚¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                alert('ì˜¬ë°”ë¥¸ ì¿ í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
            }
        }

        // í† í° ê´€ë¦¬ í•¨ìˆ˜
        function getStoredTokens() {
            const tokens = {
                localStorage: {},
                sessionStorage: {},
                cookies: {}
            };
            
            // localStorage í† í°
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.includes('token') || key.includes('auth') || key.includes('session'))) {
                    tokens.localStorage[key] = localStorage.getItem(key);
                }
            }
            
            // sessionStorage í† í°
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                if (key && (key.includes('token') || key.includes('auth') || key.includes('session'))) {
                    tokens.sessionStorage[key] = sessionStorage.getItem(key);
                }
            }
            
            // ì¿ í‚¤ í† í°
            const cookies = getAllCookies();
            Object.entries(cookies).forEach(([name, value]) => {
                if (name.includes('token') || name.includes('auth') || name.includes('session')) {
                    tokens.cookies[name] = value;
                }
            });
            
            return tokens;
        }

        function updateTokenStatus() {
            const tokens = getStoredTokens();
            const statusEl = document.getElementById('token-status');
            
            const totalCount = 
                Object.keys(tokens.localStorage).length + 
                Object.keys(tokens.sessionStorage).length + 
                Object.keys(tokens.cookies).length;
            
            if (totalCount > 0) {
                statusEl.innerHTML = `
                    <span class="text-green-600">âœ… í† í° ${totalCount}ê°œ ë°œê²¬</span>
                    <span class="text-xs text-gray-500 block">
                        Local: ${Object.keys(tokens.localStorage).length}, 
                        Session: ${Object.keys(tokens.sessionStorage).length}, 
                        Cookie: ${Object.keys(tokens.cookies).length}
                    </span>
                `;
            } else {
                statusEl.innerHTML = '<span class="text-red-600">âŒ í† í° ì—†ìŒ</span>';
            }
        }

        function syncTokens() {
            const tokens = getStoredTokens();
            console.log('ë™ê¸°í™”í•  í† í°:', tokens);
            
            // ì—´ë ¤ìˆëŠ” ëª¨ë“  ì°½ì— í† í° ì „ì†¡ ì‹œë„
            Object.values(windowRefs).forEach(win => {
                if (win && !win.closed) {
                    try {
                        win.postMessage({
                            type: 'SYNC_TOKENS',
                            tokens: tokens
                        }, '*');
                    } catch (e) {
                        console.log('í† í° ì „ì†¡ ì‹¤íŒ¨:', e);
                    }
                }
            });
            
            alert('í† í° ë™ê¸°í™”ë¥¼ ì‹œë„í–ˆìŠµë‹ˆë‹¤. ê°œë°œì ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
        }

        // UI í•¨ìˆ˜
        function selectFunction(funcId, element) {
            selectedFunction = funcId;
            selectedAdmin = null;

            document.querySelectorAll('.function-item').forEach(item => {
                item.classList.remove('function-selected');
            });
            element.classList.add('function-selected');

            const adminPanel = document.getElementById('admin-panel');
            adminPanel.classList.remove('hidden');
            adminPanel.classList.add('flex');

            document.getElementById('function-name').textContent = functionData[funcId].name;

            const adminList = document.getElementById('admin-list');
            adminList.innerHTML = '';

            functionData[funcId].admins.forEach((admin, index) => {
                const adminItem = document.createElement('div');
                adminItem.className = 'admin-item p-4 cursor-pointer border-b border-gray-100 hover:bg-green-50';
                adminItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-medium text-gray-800 flex items-center space-x-2">
                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${index + 1}</span>
                                <span>${admin.name}</span>
                                ${admin.isInternal ? '<span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">ë‚´ë¶€</span>' : ''}
                            </div>
                            <div class="text-sm text-gray-500 mt-1">${admin.desc}</div>
                            <div class="text-xs text-gray-400 mt-1">${admin.url}</div>
                        </div>
                        <div class="text-gray-400">â†’</div>
                    </div>
                `;

                adminItem.addEventListener('click', () => selectAdmin(admin, adminItem));
                adminList.appendChild(adminItem);
            });
        }

        function selectAdmin(admin, element) {
            selectedAdmin = admin;

            document.querySelectorAll('.admin-item').forEach(item => {
                item.classList.remove('admin-selected');
            });
            element.classList.add('admin-selected');

            openAdminPage(admin);
        }

        function openAdminPage(admin) {
            const emptyState = document.getElementById('empty-state');
            
            // ìƒˆ ì°½ì—ì„œ ì—´ê¸°
            const windowName = `admin_${admin.name.replace(/\s/g, '_')}`;
            const windowFeatures = 'width=1200,height=800,menubar=yes,toolbar=yes,location=yes,status=yes,scrollbars=yes,resizable=yes';
            
            const win = window.open(admin.url, windowName, windowFeatures);
            windowRefs[windowName] = win;
            
            emptyState.innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸªŸ</div>
                    <h3 class="text-xl font-medium text-gray-700 mb-2">${admin.name}</h3>
                    <p class="text-gray-500 mb-4">ìƒˆ ì°½ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤</p>
                    <div class="space-y-2">
                        <button onclick="focusWindow('${windowName}')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                            ì°½ìœ¼ë¡œ ì´ë™
                        </button>
                        ${admin.isInternal ? `
                        <div class="mt-4 p-4 bg-yellow-50 rounded-lg max-w-md mx-auto">
                            <h4 class="font-medium text-yellow-800 mb-2">ğŸ” ë‚´ë¶€ ì–´ë“œë¯¼ ë¡œê·¸ì¸ íŒ</h4>
                            <ul class="text-sm text-yellow-700 space-y-1 text-left">
                                <li>â€¢ ë¡œê·¸ì¸ í›„ 401 ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”</li>
                                <li>â€¢ ì¿ í‚¤ê°€ ì œëŒ€ë¡œ ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                <li>â€¢ ìƒë‹¨ì˜ "ì¿ í‚¤ ë™ê¸°í™”" ë²„íŠ¼ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”</li>
                                <li>â€¢ ê°œë°œì ë„êµ¬ &gt; Application &gt; Cookiesë¥¼ í™•ì¸í•˜ì„¸ìš”</li>
                            </ul>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // ë‚´ë¶€ ì–´ë“œë¯¼ì˜ ê²½ìš° ë¡œê·¸ì¸ ê°ì§€ ì‹œë„
            if (admin.isInternal) {
                setTimeout(() => {
                    checkLoginStatus(win, windowName);
                }, 3000);
            }
        }

        function focusWindow(windowName) {
            const win = windowRefs[windowName];
            if (win && !win.closed) {
                win.focus();
            } else {
                alert('ì°½ì´ ë‹«í˜”ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }
        }

        function checkLoginStatus(win, windowName) {
            if (!win || win.closed) return;
            
            try {
                // ì°½ì˜ URL í™•ì¸ ì‹œë„ (ë™ì¼ ì¶œì²˜ì—ì„œë§Œ ê°€ëŠ¥)
                const currentUrl = win.location.href;
                console.log('í˜„ì¬ URL:', currentUrl);
                
                // ë¡œê·¸ì¸ ì„±ê³µ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê°ì§€
                if (currentUrl.includes('dashboard') || currentUrl.includes('home')) {
                    alert('ë¡œê·¸ì¸ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. í† í°ì„ ë™ê¸°í™”í•˜ì„¸ìš”.');
                    updateTokenStatus();
                }
            } catch (e) {
                console.log('Cross-originìœ¼ë¡œ URL í™•ì¸ ë¶ˆê°€');
            }
            
            // ê³„ì† ëª¨ë‹ˆí„°ë§
            setTimeout(() => checkLoginStatus(win, windowName), 5000);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            // ê¸°ëŠ¥ ì„ íƒ
            document.querySelectorAll('.function-item').forEach(item => {
                item.addEventListener('click', () => {
                    const funcId = item.dataset.function;
                    selectFunction(funcId, item);
                });
            });

            // ì¿ í‚¤ ë™ê¸°í™” ë²„íŠ¼
            document.getElementById('cookie-sync-btn').addEventListener('click', showCookieModal);

            // í† í° ë™ê¸°í™” ë²„íŠ¼
            document.getElementById('token-sync-btn').addEventListener('click', syncTokens);

            // ì´ˆê¸°í™”
            updateTokenStatus();
            
            // ì£¼ê¸°ì ìœ¼ë¡œ í† í° ìƒíƒœ ì—…ë°ì´íŠ¸
            setInterval(updateTokenStatus, 5000);
        });

        // ë©”ì‹œì§€ ìˆ˜ì‹  (ë‹¤ë¥¸ ì°½ì—ì„œì˜ í† í° ë™ê¸°í™” ìš”ì²­)
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'REQUEST_TOKENS') {
                const tokens = getStoredTokens();
                event.source.postMessage({
                    type: 'SYNC_TOKENS',
                    tokens: tokens
                }, event.origin);
            }
        });
    </script>
</body>
</html>